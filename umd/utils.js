/* @preserve built on: 2021-09-07T10:27:20.725Z */
(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("jss"),require("lodash"),require("mithril"),require("mithril/stream"),require("luxon"),require("@sdxmessaging/ui-widgets")):typeof define==="function"&&define.amd?define(["exports","jss","lodash","mithril","mithril/stream","luxon","@sdxmessaging/ui-widgets"],t):(e=typeof globalThis!=="undefined"?globalThis:e||self,t(e.uiBuilder={},e.jss,e._,e.m,e.m.stream,e.luxon,e.uiWidgets))})(this,(function(e,t,n,a,r,i,l){"use strict";function u(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}var s=u(t);var o=u(n);var f=u(a);var c=u(r);const d={uiTableHeader:"ag-header",uiTableHeaderCell:"ag-header-cell"};function p(){function e(e,t,n){if(t.type!=="style")return e;if(t.id&&d[t.id.replace(/(-\d+)*/g,"")]&&n){const e=o["default"].reduce(o["default"].entries(t.style),((e,[t,n])=>{e[t]=n+" !important";return e}),{});const a=n.addRule(d[t.id.replace(/(-\d+)*/g,"")],e,{selector:"."+d[t.id.replace(/(-\d+)*/g,"")]});a.id=d[t.id]}return e}return{onProcessStyle:e}}function m(e){const t=o["default"].assign({repeat:2},e);const n=Array(t.repeat).join(":not(#\\20)");return{onProcessRule:(e,t)=>{const a=e.options.parent;if(t.options.increaseSpecificity===false||e.type!=="style"||a&&a.type==="keyframes"||e.selectorText.search(":not(#\\20)")!==-1)return;e.selectorText=n+e.selectorText}}}const h=["after","before","first-line","first-letter","selection","placeholder"];const y=["active","checked","disabled","empty","enabled","first-child","first-of-type","focus","hover","in-range","invalid","last-child","last-of-type","link","not","only-of-type","only-child","optional","out-of-range","read-only","read-write","required","root","target","valid","visited"];const g=["nth-child","nth-last-child","nth-last-of-type","nth-of-type"];const x=[{"-space-":" ","-space":" ","space-":" ",space:" "},{"-dot-":".","-dot":".","dot-":".",dot:"."},{"-dash-":"-","-dash":"-","dash-":"-",dash:"-"},{"-chevron-":" > ","-chevron":" > ","chevron-":" > ",chevron:" > "},{"-hash-":"#","-hash":"#","hash-":"#",hash:"#"},{"-star-":"*","-star":"*","star-":"*",star:"*"},{"-colon-":":","-colon":":","colon-":":",colon:":"},{"-equals-":"=","-equals":"=","equals-":"=",equals:"="},{"-sbo-":"[","-sbo":"[","sbo-":"[",sbo:"["},{"-sbc-":"]","-sbc":"]","sbc-":"]",sbc:"]"}];const v=e=>{const t=o["default"].find(g,(t=>e.search(t)!==-1));if(t){const n=e.slice(t.length+1);return`:${e.slice(0,t.length)}(${n})`}return e};const w=e=>o["default"].reduce(x,((t,n)=>{t=!t?e:t;o["default"].forEach(o["default"].entries(n),(([e,n])=>{const a=t.search(e);const r=new RegExp(e,"g");if(a!==-1){if(a===0){t=t.replace(e,n)}const i=t.search(e);if(i||a!==0){t=t.replace(r,n)}t=t.replace(/ +/," ")}}));return t}),"");const b=(e,t)=>{let n=e;h.forEach((e=>n=n.replace(new RegExp(e,"g"),"::"+e)));y.forEach((t=>{const a=["valid","last-child","last-of-type"];if(a.indexOf(t)===-1){n=n.replace(new RegExp(t,"g"),":"+t)}else{if(t==="valid"&&e.search("invalid")&&e.search("valid")!==e.search("invalid")-2){n=n.replace(new RegExp(t,"g"),":"+t)}else if(t!=="valid"&&a.indexOf(t)!==-1){if(e.search("nth-"+t)!==e.search(t)-4){n=n.replace(new RegExp(t,"g"),":"+t)}}}}));n=v(n);return`${t}${n}`};function S(e,t){const n=w(e);return b(n,t)}function I(){function e(e,t){if(t.type!=="style")return e;const n=t.options.parent;o["default"].forEach(e,((a,r)=>{if(typeof a!=="string"&&typeof a==="object"){const i=S(r,t.selector);const l=o["default"].reduce(a,((e,t,n)=>{e[o["default"].kebabCase(n)]=t;return e}),{});n.addRule(i,l,{selector:i});delete e[r]}}));return e}return{onProcessStyle:e}}const j="@media screen and (min-width:30em)";const k="@media screen and (min-width:30em) and (max-width: 60em)";const M="@media screen and (min-width:60em)";s["default"].use(I(),p());function T(e){return o["default"].mapKeys(e,((e,t)=>o["default"].kebabCase(t)))}const B=s["default"].createStyleSheet({});function P({style:e,styleNS:t,styleM:n,styleL:a,classes:r,key:i="unnamed"},l){const u=l?l:B;const s=[];const o=Boolean(i!=="unnamed"&&u.getRule(i));let f;if(e){if(o){f=u.update(i,T(e))}else{f=u.addRule(i,T(e))}if(f.id)s.push(f.id)}if(t){if(o){f=u.update(i,T(t))}else{f=u.addRule(j,{[i]:T(t)})}f=f.getRule(i);if(f.id)s.push(f.id)}if(n){if(o){f=u.update(i,T(n))}else{f=u.addRule(k,{[i]:T(n)})}f=f.getRule(i);if(f.id)s.push(f.id)}if(a){if(o){f=u.update(i,T(a))}else{f=u.addRule(M,{[i]:T(a)})}f=f.getRule(i);if(f.id)s.push(f.id)}if(s.length&&!l){u.attach()}if(r){s.push(r)}return s.join(" ")}const R=t.create({plugins:[p(),I(),m()]});class D{constructor(e){this._classes={};this.uiSheet=R.createStyleSheet({});this.applyTheme=e;this.createClasses()}get classes(){return this._classes}createClasses(){o["default"].each(this.applyTheme,((e,t)=>{this._classes[t]=P(o["default"].assign({key:t,increaseSpecificity:true},e),this.uiSheet)}));this.uiSheet.attach()}update(e){if(!o["default"].isEqual(this.applyTheme,e)){this.applyTheme=e;this.uiSheet.detach();this.createClasses()}}}function F(e){return o["default"].compact(e).join(" ")}function O(e){switch(e){case"default":return"alt";case"alt":return"default";case"altLighter":return"lighter";case"altDarker":return"darker";case"darker":return"altDarker";case"lighter":return"altLighter";case"warn":return"neutral";case"error":return"neutral";default:return"neutral"}}function C(e){return i.DateTime.fromISO(e).valueOf()}function E(e,t="D"){const n=i.DateTime.fromMillis(e);return n.isValid?n.toFormat(t,{locale:"en-GB"}):"-"}function A(e,t="HH:mm"){return E(e,t)}function $(){return i.DateTime.now().toISODate()}function q(e){const t=i.DateTime.now().startOf("day");const n=i.DateTime.fromMillis(e).startOf("day").diff(t,"day").get("days");switch(n){case-1:return"Yesterday";case 0:return"Today";case 1:return"Tomorrow";default:return E(e)}}function N(e){try{return e?q(C(e)):"-"}catch(e){return"-"}}function L(e){try{return e?A(C(e)):"-"}catch(e){return"-"}}function U(e){try{if(e){const t=C(e);return`${q(t)}, ${A(t)}`}else{return"-"}}catch(e){return"-"}}function z(e){try{return e?q(e):"-"}catch(e){return"-"}}function H(e){try{return e?A(e):"-"}catch(e){return"-"}}function V(e){try{if(e){return`${q(e)}, ${A(e)}`}else{return"-, -"}}catch(e){return"-, -"}}function _(){return window.matchMedia("only screen and (max-width: 360px)").matches}function Y(){return window.matchMedia("only screen and (max-width: 768px)").matches}function W(e,t){return o["default"].find(e,o["default"].matches(t))}function K(e,t){return o["default"].find(e,o["default"].matches({_id:t}))}function Z(e,t,n){return c["default"].lift(((e,t)=>K(e,t)||n),e,t)}function G(e,t){return o["default"].filter(e,o["default"].matches(t))}function J(e,t){return o["default"].remove(e,o["default"].matches(t))}function Q(e,{tags:t}){return o["default"].some(e,(e=>o["default"].some(t,e)))}function X(e,{tags:t}){return o["default"].every(e,(e=>o["default"].some(t,e)))}function ee(e,t,n=false){if(t.length===0){return e}const a=o["default"].partial(n?X:Q,t);return o["default"].filter(e,(t=>{if(a(t)){const n=t;return n.hideEmpty?ee(e,n.content,n.contentAll).length>0:true}return false}))}function te({readonly:e,disabled:t}){return!(e||t)}function ne(e){return Boolean(o["default"].isArray(e)?e.length:e)}function ae(e){const t={};e.forEach(((e,n)=>t[n]=e));return t}function re(e,t){o["default"].forEach(t,((t,n)=>e.set(n,t)))}function ie(e){if(e<1e3){return`${e} bytes`}else if(e<1e6){return`${o["default"].round(e/1e3)}Kb`}else{return`${o["default"].round(e/1e6)}Mb`}}function le(e,t,n){if(n){return e.label}const{props:a}=e;return t.length===1?a[t[0]]:o["default"](t).map((e=>a[e])).compact().value().join(" ")}function ue(e){return e}const se={"application/zip":{icon:"fal fa-file-archive",ext:".zip"},"application/pdf":{icon:"fal fa-file-pdf",ext:".pdf"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{icon:"fal fa-file-word",ext:".docx"},"application/msword":{icon:"fal fa-file-word",ext:".doc"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{icon:"fal fa-file-excel",ext:".xlsx"},"application/vnd.ms-excel":{icon:"fal fa-file-excel",ext:".xls"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{icon:"fal fa-file-powerpoint",ext:".pptx"},"application/vnd.ms-powerpoint":{icon:"fal fa-file-powerpoint",ext:".ppt"},"image/jpeg":{icon:"fal fa-file-image",ext:".jpeg"},"image/png":{icon:"fal fa-file-image",ext:".png"},"image/gif":{icon:"fal fa-file-image",ext:".gif"},"image/tiff":{icon:"fal fa-file-image",ext:".tiff"},"audio/mpeg":{icon:"fal fa-file-audio",ext:".mp3"},"video/mpeg":{icon:"fal fa-file-video",ext:".mpeg"},"video/quicktime":{icon:"fal fa-file-video",ext:".mov"},"video/x-msvideo":{icon:"fal fa-file-video",ext:".avi"}};function oe(e){if(se.hasOwnProperty(e)){return se[e].icon}else{return"fal fa-file-alt"}}function fe(e){if(se.hasOwnProperty(e)){return se[e].ext}else{return""}}function ce(e,t){if(t==="size"){return ie(e.size)}else if(t==="lastModified"){return V(e.lastModified)}else if(t==="type"){return f["default"]("i.fal.fa-fw",{title:e.type,class:oe(e.type)})}else{return e[t]}}function de(e,t){return o["default"].map(G(e,{prop:t}),(e=>{const{_id:t,name:n}=e;return{guid:t,name:n,path:e.remoteUrl}}))}function pe(e,{id:t}){return c["default"](de(e,t))}function me(e,t){return o["default"].get(e,t)}function he(e,{id:t}){const n=me(e,t);return n?c["default"](n):c["default"]()}function ye(e,t){if(t){if(typeof e!=="object"||typeof e!==typeof t||o["default"].isArray(e)!==o["default"].isArray(t)){throw new Error("deepMerge only supports arrays and objects and cannot merge objects of different types.")}const n=o["default"].isArray(e)?[]:{};const a=o["default"].uniq([...o["default"].keys(e),...o["default"].keys(t)]);return o["default"].reduce(a,((n,a)=>{if(a in t&&!o["default"].isUndefined(t[a])){if(typeof e[a]==="object"){n[a]=ye(e[a]||{},t[a])}else{n[a]=t[a]}}else{n[a]=e[a]}return n}),n)}return e}const ge={};function xe(e,t){if(e in ge){throw new Error(`Component ${e} is already registered`)}else{ge[e]=t}}function ve({type:e,data:t,style:n,styleNS:a,styleM:r,styleL:i,classes:l}){const u=P({style:n,styleNS:a,styleM:r,styleL:i,classes:l});if(e in ge){return f["default"](ge[e],{type:e,data:t,classes:u})}else{return f["default"]("span",`Unknown component type: ${e}`)}}function we(e){return o["default"].map(e,(e=>ve(e)))}const be={["label"]:l.Label,["trusted"]:l.TextareaInput,["hidden"]:l.BaseInput,["text"]:l.BaseInput,["password"]:l.PasswordInput,["search"]:l.BaseInput,["date"]:l.BaseInput,["time"]:l.BaseInput,["datetime-local"]:l.BaseInput,["dateInput"]:l.DateInput,["cardDate"]:l.CardDateInput,["number"]:l.BaseInput,["range"]:l.BaseInput,["email"]:l.BaseInput,["url"]:l.BaseInput,["tel"]:l.BaseInput,["color"]:l.BaseInput,["currency"]:l.CurrencyInput,["textarea"]:l.TextareaInput,["checkbox"]:l.CheckboxInput,["toggle"]:l.ToggleInput,["select"]:l.SelectInput,["radio"]:l.RadioInput};const Se={["fileMulti"]:l.FileMulti,["file"]:l.FileSelect,["imageMulti"]:l.ImageMulti,["image"]:l.ImageSelect,["sign"]:l.SignBuilder};const Ie={};o["default"].forEach(be,((e,t)=>Ie[t]=1));o["default"].forEach(Se,((e,t)=>Ie[t]=2));function je(e){if(Se.hasOwnProperty(e)){return Se[e]}else{return Se["file"]}}function ke(e){if(be.hasOwnProperty(e)){return be[e]}else{return be["text"]}}function Me(e,t){if(e===2){return je(t)}else if(e===1){return ke(t)}else{return undefined}}function Te(e="text"){return Ie[e]||3}const Be=/^ {0,}[0-9]{2}\/[0-9]{2}\/[0-9]{4} {0,}$/;const Pe=/^ {0,}(([gG][iI][rR] {0,}0[aA]{2})|((([a-pr-uwyzA-PR-UWYZ][a-hk-yA-HK-Y]?[0-9][0-9]?)|(([a-pr-uwyzA-PR-UWYZ][0-9][a-hjkstuwA-HJKSTUW])|([a-pr-uwyzA-PR-UWYZ][a-hk-yA-HK-Y][0-9][abehmnprv-yABEHMNPRV-Y]))) {0,}[0-9][abd-hjlnp-uw-zABD-HJLNP-UW-Z]{2})) {0,}$/;const Re={default:e=>e,"date-format":e=>e.map((e=>e?E(Number(e)):"")),"dateStr-format":e=>e.map((e=>e?E(new Date(String(e)).valueOf()):"")),"date-format-month":e=>e.map((e=>e?E(Number(e),"dd MMMM yyyy"):"")),"date-endofday":e=>e.map((e=>e?i.DateTime.fromISO(e,{setZone:true}).endOf("day").toISO():"")),upper:e=>e.map((e=>String(e).toUpperCase())),lower:e=>e.map((e=>String(e).toLowerCase())),snake:e=>e.map((e=>o["default"].snakeCase(String(e)))),trunc:e=>e.map((e=>o["default"].truncate(String(e),{length:15}))),"remove-whitespace":e=>e.map((e=>e?o["default"].replace(String(e),/\s/g,""):"")),boolean:e=>e.map((e=>Boolean(e))),strLength:e=>e.map((e=>e?String(e).length>0:false)),"strLength-6":e=>e.map((e=>e?String(e).length===6:false)),"test-dob":e=>e.map((e=>e?Be.test(String(e)):false)),"test-postcode":e=>e.map((e=>e?Pe.test(String(e)):false))};function De(e,t){if(Re.hasOwnProperty(e)){return Re[e](t)}else{return Re["default"](t)}}function Fe(e,t){if(!Re.hasOwnProperty(e)){Re[e]=t}}const Oe={default:e=>e.map((e=>o["default"].map(e,(({name:e})=>e)).join())),"file-name":e=>e.map((e=>o["default"].map(e,(({file:e})=>e?e.name:"")).join())),"file-type":e=>e.map((e=>o["default"].map(e,(({file:e})=>e?e.type:"")).join())),"file-size":e=>e.map((e=>o["default"].map(e,(({file:e})=>e?e.size:"")).join())),"file-lastmodified":e=>e.map((e=>o["default"].map(e,(({file:e})=>e?e.lastModified:"")).join())),path:e=>e.map((e=>o["default"].map(e,(({path:e})=>e)).join())),dataUrl:e=>e.map((e=>o["default"].map(e,(({dataUrl:e})=>e?e:"")).join()))};function Ce(e,t){if(Oe.hasOwnProperty(e)){return Oe[e](t)}else{return Oe["default"](t)}}function Ee(e,t){if(!Oe.hasOwnProperty(e)){Oe[e]=t}}const Ae={default:e=>c["default"].merge(e).map((e=>e.join())),"join-space":e=>c["default"].merge(e).map((e=>e.join(" "))),"join-newline":e=>c["default"].merge(e).map((e=>e.join("\n"))),"join-underscore":e=>c["default"].merge(e).map((e=>e.join("_"))),sum:e=>c["default"].merge(e).map((e=>o["default"].reduce(e,((e,t)=>{const n=Number.parseInt(String(t));return o["default"].isNaN(n)?e:e+n}),0))),product:e=>c["default"].merge(e).map((e=>o["default"].reduce(e,((e,t)=>{const n=Number.parseInt(String(t));return o["default"].isNaN(n)?0:e*n}),1))),and:e=>c["default"].merge(e).map((e=>o["default"].reduce(e,((e,t)=>e?t:0),true))),or:e=>c["default"].merge(e).map((e=>o["default"].reduce(e,((e,t)=>e||t?t:e),0)))};function $e(e,t){if(Ae.hasOwnProperty(e)){return Ae[e](t)}else{return Ae["default"](t)}}function qe(e,t){return o["default"].map(o["default"].compact(o["default"].at(e,t)),(({value:e})=>e))}function Ne(e,t,n){return o["default"].max(o["default"].map(t,(t=>{const a=o["default"].find(n,o["default"].matches({key:t}));return a&&a.computed?Ne(e+1,a.computed.keys,n):e})))||0}function Le(e){return o["default"].sortBy(e,(t=>Ne(0,t.computed.keys,e)))}function Ue(e){const t=o["default"].groupBy(e,(e=>"computed"in e&&e.computed?"c":"b"));const{["b"]:n,["c"]:a}=t;const r={};o["default"].reduce(n,((e,{key:t,fileValue:n,input:a})=>{const r=a?Te(a.type):3;if(r===1){e[t]={type:r,value:c["default"]()}}else if(r===2){const a=c["default"]([]);e[t]={type:r,value:Ce(n||"default",a),files:a}}return e}),r);const i=Le(a);o["default"].reduce(i,((e,{key:t,computed:{keys:n,map:a="default",merge:r="default"}})=>{let i;if(n.length>1){const t=qe(e,n);i=$e(r,t)}else if(n.length===1){i=qe(e,n)[0]}if(i){e[t]={type:1,value:De(a,i)}}return e}),r);return{fields:o["default"](e).filter((e=>"input"in e)).map((({key:e,group:t,input:n,data:a,user:i,fieldSet:l})=>{const u=r[e];const s=u.type;return{key:e,group:t,input:n,type:s,data:a,user:i,fieldSet:l,widget:Me(s,n.type||"text"),value:u.value,files:u.type===2?u.files:undefined}})).value(),streamMap:r}}function ze(e,t){return t?o["default"].assign({},e,t):e}function He({type:e,input:t,widget:n,value:a,files:r},i){if(e===2&&t&&n&&r){return f["default"](n,{field:ze(t,i),value:r})}else if(e===1&&t&&n&&a){return f["default"](n,{field:ze(t,i),value:a})}return null}function Ve(e,t){return o["default"].map(e,(e=>He(e,t)))}function _e(e){return e.type===1}const Ye=new Set(["checkbox","toggle","select","radio"]);function We(e){var t;return _e(e)&&((t=e.input)===null||t===void 0?void 0:t.type)&&!Ye.has(e.input.type)}function Ke(e){return e.type===2}function Ze(e){var t;return Ke(e)&&((t=e.input)===null||t===void 0?void 0:t.type)==="sign"}function Ge(e){return o["default"].reduce(e.fields,((e,t)=>{const{key:n,value:a}=t;if(_e(t)&&a&&a()!=null){e[n]=a()}return e}),{})}function Je(e,t){o["default"].forEach(t,((t,n)=>{if(n in e.streamMap){e.streamMap[n].value(t)}}))}e.ButtonContextMapper=O;e.ResponsiveThemeHandler=D;e.applyFileMap=Ce;e.applyMap=De;e.assembleFormField=He;e.assembleFormFieldList=Ve;e.buildComponent=ve;e.buildComponentList=we;e.buildFormFields=Ue;e.canEdit=te;e.createResponsiveClass=P;e.deepMerge=ye;e.deserialise=Je;e.extractFields=le;e.fileExt=fe;e.fileIcon=oe;e.filterByProperty=G;e.formatDate=E;e.formatTime=A;e.getFileStream=pe;e.getFileValue=ce;e.getFiles=de;e.getISODate=$;e.getProp=me;e.getPropStream=he;e.hasValue=ne;e.humaniseByteCount=ie;e.humaniseTimeValue=q;e.isFileField=Ke;e.isPropField=_e;e.isSignField=Ze;e.isTextField=We;e.itemsForCategory=ee;e.joinClasses=F;e.mapToObject=ae;e.parseDateStr=N;e.parseDateTimeStr=U;e.parseDateTimeValue=V;e.parseDateValue=z;e.parseIso=C;e.parseTimeStr=L;e.parseTimeValue=H;e.pickById=K;e.pickByIdStream=Z;e.pickByProperty=W;e.registerComponent=xe;e.registerFileMapFn=Ee;e.registerMapFn=Fe;e.removeByProperty=J;e.serialise=Ge;e.setMap=re;e.simpleResponse=ue;e.smallDevice=Y;e.tinyDevice=_;Object.defineProperty(e,"__esModule",{value:true})}));
