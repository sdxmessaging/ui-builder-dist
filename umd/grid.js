(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?e(exports,require("mithril"),require("mithril/stream"),require("lodash"),require("@sdxmessaging/ui-widgets"),require("pusher-js"),require("ag-grid-community")):typeof define==="function"&&define.amd?define(["exports","mithril","mithril/stream","lodash","@sdxmessaging/ui-widgets","pusher-js","ag-grid-community"],e):(t=t||self,e(t.uiBuilder={},t.m,t.m.stream,t._,t.uiWidgets,t.Pusher,t.agGrid))})(this,(function(t,e,n,r,i,o,a){"use strict";var s="default"in e?e["default"]:e;n=n&&n.hasOwnProperty("default")?n["default"]:n;r=r&&r.hasOwnProperty("default")?r["default"]:r;o=o&&o.hasOwnProperty("default")?o["default"]:o;var d={bind:function(){return null}};function u(t){var e=t.mock,n=t.apiKey,r=t.cloudChannel,i=t.companyChannel,a=t.userChannel,s=t.applicationChannel,u=t.applicationUserChannel;if(e){return{pusher:{connection:{bind:function(t,e){return setImmediate(e)},unbind:function(){return null}}},cloudChannel:d,companyChannel:d,userChannel:d,applicationChannel:d,applicationUserChannel:d}}var c=new o(n,{cluster:"eu",encrypted:true});return{pusher:c,cloudChannel:c.subscribe(r),companyChannel:c.subscribe(i),userChannel:c.subscribe(a),applicationChannel:c.subscribe(s),applicationUserChannel:c.subscribe(u)}}function c(t){var e=t.layoutBackground,n=e===void 0?"transparent":e,r=t.bodyText,o=r===void 0?"#333333":r,a=t.bodyFontSize,s=a===void 0?"1.25rem":a,d=t.bodyFontWeight,u=d===void 0?"200":d,c=t.background,l=c===void 0?"DodgerBlue":c,f=t.highlight,p=f===void 0?"unset":f,h=t.text,g=h===void 0?"DodgerBlue":h,v=t.altText,m=v===void 0?"white":v,y=t.logoBackground,w=y===void 0?"transparent":y,x=t.logoBorderRadius,C=x===void 0?".25rem":x,k=t.headerHeight,B=k===void 0?"3rem":k,O=t.headerBackground,F=O===void 0?l:O,P=t.headerBorderRadius,S=P===void 0?"0px":P,T=t.headerText,L=T===void 0?m:T,D=t.subheadingText,H=D===void 0?"rgba(0,0,0,.5)":D,_=t.cardBackground,E=_===void 0?l:_,R=t.cardBorderRadius,W=R===void 0?"0px":R,j=t.cardText,q=j===void 0?m:j,I=t.panelBackground,G=I===void 0?"transparent":I,U=t.panelBorderRadius,z=U===void 0?".25rem":U,A=t.footerHeight,M=A===void 0?"3rem":A,K=t.footerBackground,V=K===void 0?"#F4F4F4":K,$=t.footerText,J=$===void 0?"#999":$,N=t.lineHeight,Q=N===void 0?"1.9em":N,X=t.buttonBackground,Y=X===void 0?l:X,Z=t.buttonText,tt=Z===void 0?m:Z,et=t.buttonPadding,nt=et===void 0?".5rem":et,rt=t.buttonBorderRadius,it=rt===void 0?".25rem":rt,ot=t.tableHeaderBackground,at=ot===void 0?l:ot,st=t.tableHeaderText,dt=st===void 0?m:st,ut=t.primaryBackground,ct=ut===void 0?Y:ut,lt=t.primaryText,ft=lt===void 0?tt:lt,pt=t.bgInfo,ht=pt===void 0?"#357EDD":pt,bt=t.txtInfo,gt=bt===void 0?"#FFFFFF":bt,vt=t.bgWarn,mt=vt===void 0?"#FFD700":vt,yt=t.txtWarn,wt=yt===void 0?"#111111":yt,xt=t.bgError,Ct=xt===void 0?"#E7040F":xt,kt=t.txtError,Bt=kt===void 0?"#FFFFFF":kt,Ot=t.inpBrdClass,Ft=Ot===void 0?"bn":Ot;b.helper({shrink0:b.flexShrink("0"),safariBug:b("-webkit-transform: translate3d(0, 0, 0)"),docOverlay:b.$nest("input",b({border:"none"})),bgBranding:b({background:l}),branding:b.color(g),brandingAlt:b.color(m),ripple:b({position:"relative",overflow:"hidden",transform:"translate3d(0, 0, 0)",":after":{content:"",display:"block",position:"absolute",width:"100%",height:"100%",top:0,left:0,"pointer-events":"none","background-image":"radial-gradient(circle, #fff 10%, transparent 10.01%)","background-repeat":"no-repeat","background-position":"50%",transform:"scale(10, 10)",opacity:"0",transition:"transform .5s, opacity 1s"},":active":{":after":{transform:"scale(0, 0)",opacity:.3,transition:"0s"}}}),bgLayout:b({background:n}),body:b.c(o),bodyFSize:b.fs(s),bodyFWeight:b({"font-weight":u}),bgLogo:b({background:w}),brdLogo:b.br(C),headerHeight:b.height(B),bgHeader:b({background:F}),brdHeader:b.br(S),header:b.c(L),subheading:b.c(H),card:b.c(q),bgCard:b({background:E}),brdCard:b.br(W),bgPanel:b({background:G}),brdPanel:b.br(z),footerHeight:b.height(M),bgFooter:b({background:V}),footer:b.c(J),inputHeight:b.height(Q),inputFocus:b({":focus":{"border-color":p}}),active:b({outline:"solid 0.125rem"}),inactive:b({":hover":{outline:"solid 0.125rem"}}),empty:b({background:"transparent"}),bgThead:b({background:at}),thead:b.c(dt),bgButton:b({background:Y}),button:b.c(tt),padButton:b.p(nt),brdButton:b({border:"none"}).br(it),bgPrimary:b({background:ct}),primary:b.c(ft),bgInfo:b({background:ht}),info:b.c(gt),bgWarn:b({background:mt}),warn:b.c(wt),bgError:b({background:Ct}),error:b.c(Bt)});i.updateTheme({icon:"fal",lblCol:b.branding.class,inpHgt:b.inputHeight.class,inpBrd:Ft+" "+b.inputFocus.class,btnBg:b.ripple.bgButton.class,btnCol:b.button.class,btnPad:b.padButton.class,btnBrd:"shadow-4 "+b.brdButton.class})}var l={header:{lhs:{},rhs:{}},theme:{}};var f=function(){function t(t){if(t===void 0){t=""}this.loadBranding=n(l);this.branding=this.loadBranding.map((function(t){return r.merge({},l,t)}));this.path=t;this.header=this.branding.map((function(t){var e=t.header,n=t.theme;c(n);return e}))}t.prototype.update=function(t){this.path=t;return this.load()};t.prototype.load=function(){return this.path?e.request(this.path).then(this.loadBranding):Promise.resolve()};return t}();function p(t){if(r.isString(t)){return e.request(t)}else{return Promise.resolve(t)}}function h(t,n){n({message:String(t.message),context:"error"});e.redraw()}function g(t,n,r){window.history.replaceState(null,"",window.location.href);var o;var a;var s;return p(n).then((function(n){o=n;i.updateConfig({signFont:"Caveat"});if(o.uiWidgets){i.updateConfig(o.uiWidgets)}a=new f(o.brandingPath);s=u(t);s.applicationUserChannel.bind("reload",(function(){return window.location.reload()}));s.applicationUserChannel.bind("redirect",(function(t){return window.location.href=t.url}));s.applicationChannel.bind("reloadbranding",(function(){return a.load().then(e.redraw)}));s.applicationUserChannel.bind("notification",(function(t){r(t);e.redraw()}));return Promise.all([a.load(),new Promise((function(t){s.pusher.connection.bind("connected",(function(){return t()}))}))])})).catch((function(t){return h(t,r)})).then((function(){s.pusher.connection.unbind("connected");return{application:o,brand:a,pusher:s}}))}function v(t){if(typeof t==="string"){return s("p",t)}else if(t.hasOwnProperty("selector")){var e=t;return s(e.selector,e.content)}else{var n=t;return s("a.link.mv2.pa2.bn.br2.w-40.tc.dim.pointer"+b.bgButton.button,{href:n.href},n.text)}}var m=function(){function t(){}t.prototype.view=function(t){var e=t.attrs.data;return s(".ph4",r.map(e,(function(t){return v(t)})))};return t}();var y={};function w(t,e){if(t in y){throw new Error("Component "+t+" is already registered")}else{y[t]=e}}w("basic",m);function x(t){var e=t.type,n=t.data;if(e in y){return s(y[e],{type:e,data:n})}else{return s("span","Unknown component type: "+e)}}function C(t){return r.map(t,(function(t){return x(t)}))}var k=function(){function t(){}t.prototype.view=function(t){var e=t.attrs;if(e.hasOwnProperty("type")){return x(e)}else if(e.hasOwnProperty("icon")){var n=e;return s(".flex.items-center.mh2",{class:n.classes},s("i.fal.fa-2x.mr2",{class:n.icon}),n.title)}else if(e.hasOwnProperty("src")){var r=e;return s(".flex.items-center.mh2"+b.bgLogo.brdLogo,{class:r.classes},s("img.img",{src:r.src,class:r.imageClass,height:r.height,width:r.width}),r.title)}else{var i=e;return s(".mh2",{class:i.classes},i.title||"")}};return t}();function B(t){if(t===void 0){t="info"}switch(t){case"error":return b.bgError.error.class;case"warn":return b.bgWarn.warn.class;default:return b.bgInfo.info.class}}var O=function(){function t(){this.active=false}t.prototype.oninit=function(t){var e=this;var r=t.attrs.notification;r.map((function(t){var r=t.message,i=t.duration,o=i===void 0?3e3:i;if(r){e.active=true;setTimeout((function(){return e.dismiss()}),o)}return n.SKIP}))};t.prototype.view=function(t){var e=this;var n=t.attrs.notification;var r=n(),i=r.message,o=r.context;return s(".w-100.pa3.fixed.top-0.left-0.z-max.f5.tc.pointer",{onclick:function(){return e.dismiss()},class:B(o),style:{transition:"transform 0.5s",transform:this.active?"none":"translate(0, -100%)"}},i)};t.prototype.dismiss=function(){if(this.active){this.active=false;s.redraw()}};return t}();function F(t){return(t*100).toFixed(0)+"%"}var P=function(){function t(){this.saving=n();this.progress=n()}t.prototype.oninit=function(t){var e=t.attrs,n=e.saving,r=e.progress;if(n){this.saving=n}if(r){this.progress=r}};t.prototype.view=function(t){var e=t.attrs,n=e.application,r=n.version,i=n.auth,o=n.copyright,a=o===void 0?"2020 Secure Digital Exchange Limited":o,d=e.header,u=d.lhs,c=d.rhs,l=e.notification,f=e.containerClass,p=f===void 0?"mv2-l mw8-l shadow-4-l":f,h=e.headerClass,g=h===void 0?"":h,v=e.footerClass,m=v===void 0?"":v,y=e.logout,w=y===void 0?true:y,x=t.children;var C=this.saving();var B=C?this.progress():0;return[s("span.clip",{style:{"font-family":"Caveat"}},"test"),l?s(O,{notification:l}):null,s("main.flex-auto.flex.flex-column.self-center.w-100"+b.bgLayout.body.bodyFSize.bodyFWeight,{class:p},[s(".w-100",{class:g},s(".flex.justify-between.items-center"+b.shrink0.headerHeight.bgHeader.header,[s(k,u),s(k,c)])),x]),s(".w-100",{class:m},s("nav.ph2.flex.items-center.content-end"+b.footerHeight.bgFooter.footer,[s("p.center.f7",{title:r},[s.trust("&copy; "),a]),s("span.ma2.f3",{class:B?"":"dn"},F(B)),s("i.f3.mid-gray.fal.fa-spinner",{class:C?"fa-spin":"dn"}),i&&w?s("a.ml2.mid-gray",{href:i.logoutPath},s("i.fal.fa-fw.fa-2x.fa-sign-out-alt[aria-hidden=true]")):null]))]};return t}();var S=function(){function t(){}t.prototype.view=function(t){var e=t.attrs,n=e.header,r=e.headerClass,i=e.subheader,o=e.subheaderClass,a=e.content,d=e.wrapContent,u=d===void 0?true:d,c=e.footer;return[n?s(".flex.justify-between.items-center"+b.shrink0.bgBranding.brandingAlt,{class:r},n):null,i?s("div"+b.shrink0,{class:o},i):null,u?s(".flex-auto.overflow-x-hidden.overflow-y-auto"+b.safariBug,a):a,c]};return t}();var T=function(){function t(){this.id=r.uniqueId("search-")}t.prototype.view=function(t){var e=t.attrs,n=e.placeholder,r=e.searchValue;return s("form.flex.flex-row.items-center.bg-light-gray",{onsubmit:function(){return false}},s("label.fal.fa-fw.fa-search.w2.pv2.pl2.tc.pointer"+b.header,{for:this.id}),s(i.BaseInput,{field:{id:this.id,label:"",type:"search",classes:"pa2 bg-transparent",placeholder:n,instant:true},value:r}),r()?s("i.fal.fa-fw.fa-times.pa2.tc.pointer.dim"+b.subheading,{title:"Reset Search",onclick:function(){return r("")}}):null)};return t}();var L=function(){function t(){this.gridOptions={suppressCellSelection:true,rowData:[]}}t.prototype.oncreate=function(t){var e=this;var n=t.dom,r=t.attrs,i=r.columnDefs,o=r.filter,s=r.test,d=r.load;this.gridOptions.columnDefs=i;this.gridOptions.context=o();this.gridOptions.isExternalFilterPresent=function(){return o().length>0};this.gridOptions.doesExternalFilterPass=s;new a.Grid(n,this.gridOptions);this.showLoading();d({offset:0,limit:-1}).then((function(t){var n;e.hideLoading();(n=e.gridOptions.api)===null||n===void 0?void 0:n.setRowData(t)}))};t.prototype.onupdate=function(t){var e=t.attrs.filter;if(this.gridOptions.context===e()){return}this.gridOptions.context=e();if(this.gridOptions.api){this.gridOptions.api.onFilterChanged();this.gridOptions.api.redrawRows()}};t.prototype.onremove=function(){var t;(t=this.gridOptions.api)===null||t===void 0?void 0:t.destroy()};t.prototype.view=function(){return s(".h-100.flex-auto.ag-theme-balham")};t.prototype.showLoading=function(){var t;(t=this.gridOptions.api)===null||t===void 0?void 0:t.showLoadingOverlay()};t.prototype.hideLoading=function(){var t;(t=this.gridOptions.api)===null||t===void 0?void 0:t.hideOverlay()};return t}();var D=this&&this.__extends||function(){var t=function(e,n){t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n]};return t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();function H(t,e,n){return{getRows:function(r){var i=r.startRow,o=r.endRow,a=r.successCallback,s=r.failCallback;var d=o-i;e();t({offset:i,limit:d+1}).then((function(t){if(t.length>d){a(t.slice(0,d))}else{a(t,i+t.length)}})).catch(s).then((function(){return n()}))}}}var _=function(t){D(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.gridOptions={suppressCellSelection:true,rowModelType:"infinite",blockLoadDebounceMillis:400};return e}e.prototype.oncreate=function(t){var e=t.dom,n=t.attrs,i=n.columnDefs,o=n.filter,s=n.load;this.gridOptions.columnDefs=i;this.gridOptions.context=o();this.gridOptions.datasource=H(s,r.bind(this.showLoading,this),r.bind(this.hideLoading,this));new a.Grid(e,this.gridOptions)};e.prototype.view=function(){return s(".h-100.flex-auto.ag-theme-balham")};return e}(L);(function(t){t[t["Single"]=0]="Single";t[t["Paging"]=1]="Paging"})(t.GridType||(t.GridType={}));function E(e,r,i){var o=i.fullScreen,a=o===void 0?true:o,d=i.type,u=d===void 0?t.GridType.Single:d,c=i.filter,l=i.columnDefs,f=i.test,p=i.load;var h=n({message:""});g(e,r,h).then((function(e){var n=e.application,r=e.brand;s.mount(document.getElementById("page"),{view:function(){return s(P,{header:r.header(),application:n,notification:h,containerClass:a?"":undefined},s(S,{subheader:s(T,{placeholder:"Search",searchValue:c}),content:s(".pa2.flex.flex-column.aspect-ratio--object",[s(u===t.GridType.Single?L:_,{columnDefs:l,filter:c,test:f,load:p})])}))}})}))}t.buildComponent=x;t.buildComponentList=C;t.grid=E;t.registerComponent=w;Object.defineProperty(t,"__esModule",{value:true})}));
